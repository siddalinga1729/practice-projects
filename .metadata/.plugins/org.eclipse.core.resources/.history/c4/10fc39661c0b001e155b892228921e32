package com.demoswagger.service;

import java.lang.reflect.Field;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Scope;
import org.springframework.context.annotation.ScopedProxyMode;
import org.springframework.stereotype.Service;
import org.springframework.util.ReflectionUtils;
import org.springframework.web.context.WebApplicationContext;

import com.demoswagger.entity.Book;
import com.demoswagger.repo.BookRepo;

@Service
@Scope(value = WebApplicationContext.SCOPE_REQUEST, proxyMode = ScopedProxyMode.TARGET_CLASS)
public class BookServiceImpl implements BookService {
	@Autowired
	private BookRepo bookRepo;

	@Override
	public void saveBook(Book book) {
		bookRepo.save(book);
	}

	@Override
	public List<Book> getAllBook() {
		return bookRepo.findAll();
	}

	@Override
	public void updateBooks(Map<String, Object> userInputs, Long id) {
		if (bookRepo.findById(id).isPresent()) {
			userInputs.forEach((key, value) -> {
					Field field = ReflectionUtils.findField(Book.class, key);
					field.setAccessible(true);
					ReflectionUtils.setField(field, bookRepo.findById(id).get(), value);
			});
			bookRepo.save(bookRepo.findById(id).get());
		}

	}
	public static void main(String[] args) {
		SimpleDateFormat inputFormat = new SimpleDateFormat("HH:mm:ss");
		SimpleDateFormat outputFormat = new SimpleDateFormat("hh:mm");
		String inputTime = "14:30"; // Example input time value

		try {
		    Date date = inputFormat.parse(inputTime);
		    String outputTime = outputFormat.format(date);

		    System.out.println(outputTime); // Output: 02:30 PM
		} catch (ParseException e) {
		    e.printStackTrace();
		}

	}
}
